    rules_version = '2';
    service cloud.firestore {
      match /databases/{database}/documents {
        // WARNING: These rules are HIGHLY permissive and are ONLY for development/testing.
        // They allow any authenticated user to read/write to ANY document in 'chats' and 'workouts' collections.
        // DO NOT use these in a production environment without significant modification!

        match /workouts/{workoutId} {
          allow read: if request.auth != null && 
            (resource.data.userId == request.auth.uid || resource.data.isPublic);
          allow create: if request.auth != null && 
            request.resource.data.userId == request.auth.uid;
          allow update, delete: if request.auth != null && 
            resource.data.userId == request.auth.uid;
        }

        match /user_workout_stats/{userId} {
          allow read: if request.auth != null;
          allow write: if request.auth != null && 
            request.auth.uid == userId;
        }

        // Allow authenticated users to read and write their own user profiles
        match /users/{userId} {
          allow read, write: if request.auth != null && request.auth.uid == userId;
        }

        // Allow authenticated users to read and write to any document in 'chats' collection. (For development/testing)
        match /chats/{document=**} {
          allow read, write: if request.auth != null;
        }
      }
    }